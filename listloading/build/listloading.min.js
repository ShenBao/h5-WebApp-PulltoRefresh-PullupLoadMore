(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Listloading=b()}}}(this,function(){var c=(function(){var h,j,k,g,e,f,i;k={};i=this;h=function(m,o){var l,n;l=(n=k[m])!=null?n:k[m]=[];return l.push(o)};g=function(l,m){e(l);return h(l,m)};e=function(l){var m;return(m=k[l])!=null?m.length=0:void 0};f=function(){var o,l,q,m,p,n;n=Array.prototype.shift.call(arguments);l=(p=k[n])!=null?p:k[n]=[];for(q=0,m=l.length;q<m;q++){o=l[q];if(o==undefined){return false}if(o.apply(i,arguments)===false){return false}}};return{listen:h,one:g,remove:e,trigger:f}})();function b(i){var h=Date.parse(new Date());var k=(h-i)/1000;var j=parseInt(k/86400);var e=parseInt(k/3600);var l=parseInt(k/60);var f=parseInt(k);if(j>0&&j<4){return j+"天前"}else{if(j<=0&&e>0){return e+"小时前"}else{if(e<=0&&l>0){return l+"分钟前"}else{if(l<=0&&f>=0){return"刚刚之前"}else{var g=new Date(i);return g.getFullYear()+"年"+(g.getMonth()+1)+"月"+g.getDate()+"日 "+g.getHours()+":"+":"+g.getMinutes()+":"+g.getSeconds()}}}}}function d(f,e){this.ele=$(f);var g=this.ele.attr("id");if(!g){g="listLoading"+Math.random().toString().replace("0.","");this.ele.attr("id",g)}this.id=g;this.children=$(this.ele.get(0).children[0]);if(typeof e!=="object"||!$.isFunction(e.pullDownAction)){this.iscroll=new IScroll("#"+g,e.iscrollOptions);return}this.pullUpId="pullUp-"+g;this.pullDownId="pullDown-"+g;this.init(e)}d.prototype={version:"1.1.4",init:function(e){this.options={};this.options.upLoadmoretxt='<i class="icon-up"></i>上拉加载更多';this.options.pullDrefreshtxt='<i class="icon-down"></i>下拉加载更多';this.options.loadertxt='<i class="icon-loading"></i>正在加载更多';this.options.Realtimetxt="松开刷新";this.options.loaderendtxt="已显示完全部";this.options.viewHeight=this.ele.height();this.options.pullUpActionStr="pullUpActionStr"+this.id;this.options.pullDownActionStr="pullDownAction"+this.id;c.remove(this.options.pullUpActionStr);c.remove(this.options.pullDownActionStr);$.extend(this.options,e);this.render()},render:function(){this.pullDownAction(true)},destroy:function(){this.children.css({"-webkit-transform":"","transform":""});$("#"+this.pullDownId+", #"+this.pullUpId).remove();this.iscroll.destroy()},refresh:function(e){this.createPullUpEle(e)},createPullUpEle:function(l){var j=this.options;var f=this.children;f.css("min-height","auto");var e=f.height();var i=this.pullUpId;var g=j.viewHeight;var m=j.pullDownOffset;var k=this.iscroll;j.minScrollHeight=g+m;if(this.pullUpEle){if(e<j.minScrollHeight){this.pullUpEle.remove();this.pullUpEle=null;this.options.pullUpOffset=0;f.css("min-height",j.minScrollHeight)}}else{if($.isFunction(j.pullUpAction)&&e>j.minScrollHeight){var h='<div id="'+i+'" data-class="pullUpId">'+'<span class="pullUpLabel inlineblock-span">'+j.upLoadmoretxt+"</span></div>";f.append(h);this.pullUpEle=$("#"+i);j.pullUpOffset=this.pullUpEle.get(0).offsetHeight}else{f.css("min-height",j.minScrollHeight)}}if(k){if(this.pullUpEle&&!l){this.pullUpEle.height(0)}k.refresh();if(this.pullUpEle&&!l){this.pullUpEle.removeAttr("style");k.maxScrollY=k.maxScrollY-this.options.pullUpOffset}if(k.y===0&&!l){this.resizeAnimate()}}},createPullIScroll:function(){var g=this.options;var e="";if(g.disableTime){g.endDate=Date.parse(new Date());e='<span class="time">最后更新时间：<em id="'+this.id+'time-em">'+b(g.endDate)+"</em></span>"}var f=$('<div id="'+this.pullDownId+'" data-class="pullDownId">'+'    <span class="pullDownLabel inlineblock-span">'+g.pullDrefreshtxt+"</span>"+e+"</div>");f.prependTo(this.children);this.pullDownEle=f;this.options.pullDownOffset=f.get(0)?f.get(0).offsetHeight:0;this.createPullUpEle()},toggleClassText:function(f,e,h,g){f.attr("class",e).find("."+h).html(g)},resizeAnimate:function(h){var g=this.iscroll;var f=this.options.pullDownOffset;if(!h){h=-f}else{var e=-g.maxScrollY-f;if(-h<=e){h=-e}}g.scrollTo(0,h,300,IScroll.utils.ease.quadratic)},scrollEvent:function(){var o=this;var j=this.options;var k=this.iscroll;var i=this.pullUpId;var m=this.pullDownEle;var f=this.toggleClassText;var g=j.pullDrefreshtxt;var e=j.upLoadmoretxt;var h=j.Realtimetxt;var n=j.loadertxt;var l=-j.pullDownOffset;this.ele.get(0).addEventListener("touchstart",function(p){p.returnValue=true});k.on("scrollStart",function(){var p=o.pullUpEle;o.startPullTime=new Date().getTime();if(j.disableTime){$("#"+o.id+"time-em").html(b(j.endDate))}if(m&&m.hasClass("loading")){f(m,"","pullDownLabel",g)}else{if(p&&p.hasClass("loading")){f(p,"","pullUpLabel",e)}}});k.on("scrollMove",function(){var u=this.y;var s=this.maxScrollY;var q=o.pullUpEle;var t=5;var p=m.hasClass("flip");var r=q&&q.hasClass("flip");if(u>t&&!p){f(m,"flip","pullDownLabel",'<i class="icon-up"></i>'+h)}else{if(u<t&&p){f(m,"","pullDownLabel",g)}else{if(q&&u<(s-t)&&!r){f(q,"flip","pullUpLabel",'<i class="icon-down"></i>'+h)}else{if(q&&u>(s+t)&&r){f(q,"","pullUpLabel",e)}}}}});k.on("scrollEnd",function(){var s=this.y;var r=this.maxScrollY;var q=o.pullUpEle;var p=new Date();if(s===r&&q){f(q,"flip","pullUpLabel",h)
}o.endPullTime=p.getTime();o.totalGapTime=o.endPullTime-o.startPullTime;o.options.endDate=Date.parse(p);if(o.totalGapTime<200){if(s>l&&s<1){o.resizeAnimate()}return}if(m&&m.hasClass("flip")){f(m,"loading","pullDownLabel",n);o.pullDownAction()}else{if(q&&q.hasClass("flip")){f(q,"loading","pullUpLabel",n);o.pullUpAction()}else{if(s>l&&s<1){o.resizeAnimate()}else{if(-r>=-s&&(r+j.pullUpOffset)>s){o.resizeAnimate(r+j.pullUpOffset)}}}}})},pullDownAction:function(e){var g=new Date().getTime()-this.startPullTime;var f=this;var k=this.options;var h=k.pullDownAction;var j=k.pullDownActionStr;var i=$("#"+f.id);if($.isFunction(h)){if(!this.iscroll){c.listen(j,function(){f.createPullIScroll();var l={startY:-k.pullDownOffset,listLoading:true,scrollbars:true};$.extend(l,k.iscrollOptions);f.iscroll=new IScroll("#"+f.id,l);f.scrollEvent();c.remove(j)});h(function(){c.trigger(j)},e)}if(g>=400){c.listen(j,function(){f.refresh(true);var l=f.pullUpEle;if(l){l.find(".pullUpLabel").html(k.upLoadmoretxt)}else{f.createPullUpEle()}setTimeout(function(){$("body").removeClass("iscroll");f.resizeAnimate();f.iscroll.refresh();c.remove(j)},1000)});h(function(){$("body").addClass("iscroll");c.trigger(j)},e)}}},pullUpAction:function(){var f=this;var g=new Date().getTime()-f.startPullTime;var k=f.options;var e=k.pullUpAction;var j=k.pullUpActionStr;var i=f.iscroll;if($.isFunction(e)){var h=i.y+k.pullUpOffset;if(g>=400){c.listen(j,function(){f.refresh(true);var l=f.pullUpEle;var m=k.loaderendtxt;if(k.pullEnd){setTimeout(function(){$("body").removeClass("iscroll");f.resizeAnimate(h)},1000)}else{$("body").removeClass("iscroll");m=k.upLoadmoretxt;i.refresh()}l.find(".pullUpLabel").html(m);c.remove(j)});e(function(l){$("body").addClass("iscroll");k.pullEnd=l;c.trigger(j)})}else{f.resizeAnimate(h)}}},evt:function a(h,i,t,B){var k="ontouchstart" in window;var g=k?"touchstart":"click",x=k?"touchstart":"mousedown",p=k?"touchend":"mouseup",r=k?"touchmove":"mousemove",n=k?"touchleave":"mouseout";var e=function(C){var D={};var E=C.originalEvent;if(E==undefined){E=C}if(E.changedTouches){D.pageX=E.changedTouches[0].pageX;D.pageY=E.changedTouches[0].pageY;D.clientX=E.changedTouches[0].clientX;D.clientY=E.changedTouches[0].clientY}else{D.pageX=C.pageX;D.pageY=C.pageY;D.clientX=C.clientX;D.clientY=C.clientY}D.evt=C;return D};var l=function(C){return{x:C.clientX,y:C.clientY}};var j=function(D,C){if(!D||!C){return 0}return Math.sqrt((D.x-C.x)*(D.x-C.x)+(D.y-C.y)*(D.y-C.y))};var w=function(E,C,F){var D=e(C);F(E,D)};var A=function(E,C,F){var D=e(C);F(E,D)};var o=function(E,C,F){var D=e(C);F(E,D)};var z=function(E,C,F){var D=e(C);F(E,D)};var s=function(C,E){var D=e(C);E(dom,D)};var m=this.ele;if(B==undefined){B=true}switch(i){case"mousemove":case"touchmove":if(B){m.off(r,h)}m.on(r,h,function(C){z($(this),C,t)});break;case"click":case"tap":var v=20;var y;var f;var q=function(D){var C=e(D);f=l(C)};var u=function(F,H,E){var G=e(H);var D=Date.now();var C=l(G);var I=j(f,C);if(I<v){w(F,H,t)}};if(B){m.off(x,h);m.off(p,h)}m.on(x,h,function(C){if(C.button!=2){q(C)}});m.on(p,h,function(D){if(D.button!=2){var C=$(this);u(C,D,t)}});break;case"mousedown":case"touchstart":if(B){m.off(x,h)}m.on(x,h,function(C){A($(this),C,t)});break;case"mouseup":case"touchend":if(B){m.off(p,h)}m.on(p,h,function(C){o($(this),C,t)});break;case"mouseout":if(B){m.off(n,h)}m.on(n,h,function(C){u(C,t)});break}}};return d}));